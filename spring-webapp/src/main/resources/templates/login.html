<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>JobBoard &mdash; Website Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" th:href="@{/css/custom-bs.css}">
    <link rel="stylesheet" th:href="@{/css/jquery.fancybox.min.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}">
    <link rel="stylesheet" th:href="@{/fonts/icomoon/style.css}">
    <link rel="stylesheet" th:href="@{/fonts/line-icons/style.css}">
    <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/css/animate.min.css}">
    <link rel="stylesheet" th:href="@{/css/quill.snow.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
          integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- MAIN CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:inline="javascript">
        var mess = /*[[${mess}]]*/ '';
    </script>
</head>
<style>
    #overlay1 {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Mờ với độ trong suốt 50% */
      z-index: 100;
    }

    /* Style cho form đăng ký popup */
    #forgot-password {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      z-index: 101; /* Đảm bảo form nằm trên overlay */
      border-radius: 10px;
      width: 70%;
      overflow: auto;
      height: 85%;
    }
</style>
<body id="top">

<!--<div id="overlayer"></div>-->
<!--<div class="loader">-->
<!--    <div class="spinner-border text-primary" role="status">-->
<!--        <span class="sr-only">Loading...</span>-->
<!--    </div>-->
<!--</div>-->


<div class="site-wrap">

    <div th:replace="~{common/header :: header}"></div>

    <!-- HOME -->
    <section class="section-hero overlay inner-page bg-image" style="background-image: url('/images/hero_1.jpg');"
             id="home-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <h1 class="text-white font-weight-bold">Login</h1>
                    <div class="custom-breadcrumbs">
                        <a href="/">Home</a> <span class="mx-2 slash">/</span>
                        <span class="text-white"><strong>Log In</strong></span>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="site-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mb-6">
                    <h2 class="mb-6">Login To JobBoard</h2>
                    <form action="/admin/loginUser" class="p-4 border rounded" method="POST">
                        <div class="row form-group">
                            <div class="col-md-12 mb-3 mb-md-0">
                                <label class="text-black" for="username">Please input username</label>
                                <input required type="text" id="username" class="form-control" name="username">
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-md-12 mb-3 mb-md-0">
                                <label class="text-black" for="password">Please input password</label>
                                <input required type="password" id="password" class="form-control" name="password">
                            </div>
                        </div>
                        <a href="#" id="show-form" class="text-right">Forgot Password</a>
                        <div class="row form-group">
                            <div class="col-md-12">
                                <input type="submit" value="Log in" class="btn px-4 btn-primary text-white">
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </section>
    <div id="overlay1">
        <div id="forgot-password">
            <h2>Forgot Password</h2>
            <!-- Thêm các trường đăng ký ở đây -->
            <form class="forms-sample" id="form" action="/" >
                <div class="form-group row">
                    <div class="col-md-12 mb-3 mb-md-0">
                        <label for="email" class="text-black">Email</label>
                        <div class="row">
                            <input required type="email" name="email" id="email" placeholder="Email" value="" style="margin-left: 10px;" class="form-control col-sm-7" >
                            <button type="button" class="btn px-4 btn-primary text-white col-sm-4" style="margin-left: 10px;" onClick="sendEmail()">Send OTP</button>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="password" class="col-sm-3 col-form-label">New Password</label>
                    <div class="col-sm-9">
                        <input required type="password" name="password" class="form-control" id="newpassword" placeholder="Password" value="">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="confirmPassword" class="col-sm-3 col-form-label">ConfirmPassword</label>
                    <div class="col-sm-9">
                        <input required type="password" name="confirmPassword" class="form-control" id="confirmPassword" placeholder="ConfirmPassword" value="">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="otp" class="col-sm-3 col-form-label">Mã xác nhận</label>
                    <div class="col-sm-9">
                        <input required type="text" class="form-control" id="otp" placeholder="Mã xác nhận" value="">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary me-2" onClick="register()">Đổi mật khẩu</button>
                <button type="button" id="close-forgot-password-form" class="btn btn-light">Cancel</button>
            </form>
        </div>
    </div>
    <div th:replace="~{common/footer :: footer}"></div>

</div>


<!-- SCRIPTS -->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/isotope.pkgd.min.js}"></script>
<script th:src="@{/js/stickyfill.min.js}"></script>
<script th:src="@{/js/jquery.fancybox.min.js}"></script>
<script th:src="@{/js/jquery.easing.1.3.js}"></script>

<script th:src="@{/js/jquery.waypoints.min.js}"></script>
<script th:src="@{/js/jquery.animateNumber.min.js}"></script>
<script th:src="@{/js/owl.carousel.min.js}"></script>
<script th:src="@{/js/quill.min.js}"></script>


<script th:src="@{/js/bootstrap-select.min.js}"></script>

<script th:src="@{/js/custom.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>
<script>
    function warning() {
        let icon = '';
        let title = '';
        let text = '';
        if (mess == "login fail") {
            icon = 'warning'
            title = 'Oosp. Fail!!!'
            text = 'Sai tài khoản hoặc mật khẩu'
        }else if (mess == "blocked") {
            icon = 'warning'
            title = 'Oosp. Fail!!!'
            text = 'Tài khoản này đã bị khóa'
        }

        if (icon != '' && title != '' && text != '')
            Swal.fire({
                icon: icon,
                title: title,
                text: text
            })
    }
    warning()


    let OTP = "-1"
    // JavaScript để xử lý hiển thị/ẩn form đăng ký popup
    const showFormButton = document.getElementById('show-form');
    const closeForgotPasswordButton = document.getElementById('close-forgot-password-form');
    const forgotPassword = document.getElementById('forgot-password');
    const overlay1 = document.getElementById('overlay1');

    showFormButton.addEventListener('click', () => {
      forgotPassword.style.display = 'block';
      overlay1.style.display = 'block';
    });

    closeForgotPasswordButton.addEventListener('click', () => {
      forgotPassword.style.display = 'none';
      overlay1.style.display = 'none';
    });

    function sendEmail() {
        var email = $("#email").val();

        if(email != "" && email.length > 10){
            $.ajax({
                url: "/sendOTPToGetPassword?email="+email,
                method: "GET",
                contentType: "application/json",
                success: function (response) {
                console.log(response)
                        OTP = response
                        Swal.fire({
                            icon: 'success',
                            title: 'Congratulation!!!!!!',
                            text: 'Mã OTP đã được gửi đến email của bạn'
                        })
                },
            });
        }else{
            Swal.fire({
                icon: 'warning',
                title: 'Oosp. Fail!!!',
                text: 'Vui lòng kiểm tra lại email'
            })
        }
    }

    function register(){
        event.preventDefault()
        var password = $("#newpassword").val();
        var confirmPassword = $("#confirmPassword").val();
        var otp = $("#otp").val();

        if(otp != OTP ){
            Swal.fire({
                icon: 'warning',
                title: 'Oosp. Fail!!!',
                text: 'OTP không chính xác vui lòng nhập lại'
            })
        }else if(password === confirmPassword){
             $.ajax({
                url: "/changePassword?email="+$("#email").val()+"&&password="+password,
                method: "GET",
                contentType: "application/json",
                success: function (response) {
                    if(response == "Change Password is successfully"){
                        Swal.fire({
                            icon: 'success',
                            title: 'Conggratulation!!!',
                            text: response
                        })
                        forgotPassword.style.display = 'none';
                        overlay1.style.display = 'none';
                    }
                },
            });
        }else{
            Swal.fire({
                icon: 'warning',
                title: 'Oosp. Fail!!!',
                text: 'Mật khẩu và nhập lại mật khẩu không khớp'
            })
        }
    }
</script>
</body>
</html>

